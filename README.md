# keybase-chat-bot

Script Keybase Chat in Node.js!

This module is a side-project/work in progress and may change or have crashers, but feel free to play with it. As long as you have a Keybase account and a paper key, you can use this module to script basic chat commands.

For more information about the API this module uses, run `keybase chat api -h` from your terminal.

- [Installation](#installation)
- [Hello World](#hello-world)
- [API](#api)
- [Contributions](#contributions)

# Installation

Make sure to [install Keybase](https://keybase.io/download).

```bash
npm install keybase-chat-bot
```

### Hello world

```javascript
//
// Says hello to the keybase `kbot` account
//

const bot = new Bot()

try {
  await bot.init({username: process.env.KB_USERNAME, paperkey: process.env.KB_PAPERKEY, verbose: false})
  console.log(`Your bot is initialized. It is logged in as ${bot.myInfo().username}`)
  const channel = {name: 'kbot,' + bot.myInfo().username, public: false, topic_type: 'chat'}
  const sendArg = {
    channel: channel,
    message: {
      body: `Hello kbot! This is ${bot.myInfo().username} saying hello from my device ${
        bot.myInfo().devicename
      }`,
    },
  }
  await bot.chatSend(sendArg)
  console.log('Message sent!')
} catch (error) {
  console.error(error)
} finally {
  await bot.deinit()
}
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [Bot](#bot)
  - [init](#init)
    - [Parameters](#parameters)
    - [Examples](#examples)
  - [myInfo](#myinfo)
    - [Examples](#examples-1)
  - [deinit](#deinit)
    - [Examples](#examples-2)
- [Bot Types](#bot-types)
  - [InitOptions](#initoptions)
    - [Properties](#properties)
- [Chat](#chat)
  - [list](#list)
    - [Parameters](#parameters-1)
    - [Examples](#examples-3)
  - [read](#read)
    - [Parameters](#parameters-2)
  - [send](#send)
    - [Parameters](#parameters-3)
    - [Examples](#examples-4)
  - [delete](#delete)
    - [Parameters](#parameters-4)
    - [Examples](#examples-5)
  - [watchChannelForNewMessages](#watchchannelfornewmessages)
    - [Parameters](#parameters-5)
    - [Examples](#examples-6)
  - [watchAllChannelsForNewMessages](#watchallchannelsfornewmessages)
    - [Parameters](#parameters-6)
    - [Examples](#examples-7)
- [Chat Types](#chat-types)
  - [ChatChannel](#chatchannel)
    - [Properties](#properties-1)
  - [ChatMessage](#chatmessage)
    - [Properties](#properties-2)
  - [ChatConversation](#chatconversation)
    - [Properties](#properties-3)
  - [ChatListOptions](#chatlistoptions)
    - [Properties](#properties-4)
  - [ChatReadOptions](#chatreadoptions)
    - [Properties](#properties-5)
  - [ChatSendOptions](#chatsendoptions)
    - [Properties](#properties-6)
  - [ChatDeleteOptions](#chatdeleteoptions)
    - [Properties](#properties-7)
  - [OnMessage](#onmessage)
  - [OnError](#onerror)

### Bot

[lib/index.js:7-60](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/index.js#L7-L60 'Source code on GitHub')

A Keybase bot.

#### init

[lib/index.js:29-35](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/index.js#L29-L35 'Source code on GitHub')

Initialize your bot by starting an instance of the Keybase service and logging in using oneshot mode.

##### Parameters

- `username` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The username of your bot's Keybase account.
- `paperkey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The paperkey of your bot's Keybase account.
- `options` **[InitOptions](#initoptions)** The initialization options for your bot.

##### Examples

```javascript
bot.init('username', 'paperkey')
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

#### myInfo

[lib/index.js:44-46](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/index.js#L44-L46 'Source code on GitHub')

Get info about your bot!

##### Examples

```javascript
const info = bot.myInfo()
```

Returns **BotInfo?** â€“ Useful information like the username, device, and home directory of your bot. If your bot isn't initialized, you'll get `null`.

#### deinit

[lib/index.js:54-59](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/index.js#L54-L59 'Source code on GitHub')

Deinitializes the bot by logging out, stopping the keybase service, and removing any leftover login files made by the bot. This should be run before your bot ends.

##### Examples

```javascript
bot.deinit()
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

### Bot Types

A collection of types used by the bot.

#### InitOptions

[lib/service/index.js:10-12](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/service/index.js#L7-L9 'Source code on GitHub')

Options for initializing the bot.

Type: {verbose: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?}

##### Properties

- `verbose` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**

### Chat

[lib/chat-client/index.js:25-200](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L25-L200 'Source code on GitHub')

**Extends ClientBase**

The chat module of your Keybase bot.

#### list

[lib/chat-client/index.js:34-38](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L34-L38 'Source code on GitHub')

Lists your chats, with info on which ones have unread messages.

##### Parameters

- `options` **[ChatListOptions](#chatlistoptions)** An object of options that can be passed to the method.

##### Examples

```javascript
const chatConversations = bot.chat.list({unreadOnly: true})
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[ChatConversation](#chatconversation)>>** An array of chat conversations. If there are no conversations, the array is empty.

#### read

[lib/chat-client/index.js:46-55](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L46-L55 'Source code on GitHub')

Reads the messages in a channel. You can read with or without marking as read.

##### Parameters

- `channel` **[ChatChannel](#chatchannel)** The chat channel to read messages in.
- `options` **[ChatReadOptions](#chatreadoptions)** An object of options that can be passed to the method.

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

#### send

[lib/chat-client/index.js:68-86](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L68-L86 'Source code on GitHub')

Send a message to a certain channel.

##### Parameters

- `channel` **[ChatChannel](#chatchannel)** The chat channel to send the message in.
- `message` **[ChatMessage](#chatmessage)** The chat message to send.
- `options` **[ChatSendOptions](#chatsendoptions)** An object of options that can be passed to the method.

##### Examples

```javascript
const channel = {name: 'kbot,' + bot.myInfo().username, public: false, topic_type: 'chat'}
const message = {body: 'Hello kbot!'}
bot.chat.send(channel, message)
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

#### delete

[lib/chat-client/index.js:99-107](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L99-L107 'Source code on GitHub')

Deletes a message in a channel. Messages have messageId's associated with
them, which you can learn in `bot.chat.read`. Known bug: the GUI has a cache,
and deleting from the CLI may not become apparent immediately.

##### Parameters

- `channel` **[ChatChannel](#chatchannel)** The chat channel to send the message in.
- `messageId` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** The chat message to send.
- `options` **[ChatDeleteOptions](#chatdeleteoptions)** An object of options that can be passed to the method.

##### Examples

```javascript
bot.chat.delete(channel, 314)
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

#### watchChannelForNewMessages

[lib/chat-client/index.js:129-136](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L129-L136 'Source code on GitHub')

Listens for new chat messages on a specified channel. The `onMessage` function is called for every message your bot receives. This is pretty similar to `watchAllChannelsForNewMessages`, except it specifically checks one channel.

##### Parameters

- `channel` **[ChatChannel](#chatchannel)** The chat channel to watch.
- `onMessage` **[OnMessage](#onmessage)** A callback that is triggered on every message your bot receives.
- `onError` **[OnError](#onerror)** A callback that is triggered on any error that occurs while the method is executing.

##### Examples

```javascript
// Reply to all messages between you and `kbot` with 'thanks!'
const channel = {name: 'kbot,' + bot.myInfo().username, public: false, topic_type: 'chat'}
const onMessage = message => {
  const channel = message.channel
  bot.chat.send({
    channel: channel,
    message: {
      body: 'thanks!!!',
    },
  })
}
bot.chat.watchChannelForNewMessages(channel, onMessage)
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

#### watchAllChannelsForNewMessages

[lib/chat-client/index.js:161-164](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L161-L164 'Source code on GitHub')

This function will put your bot into full-read mode, where it reads
everything it can and every new message it finds it will pass to you, so
you can do what you want with it. For example, if you want to write a
Keybase bot that talks shit at anyone who dares approach it, this is the
function to use.

##### Parameters

- `onMessage` **[OnMessage](#onmessage)** A callback that is triggered on every message your bot receives.
- `onError` **[OnError](#onerror)** A callback that is triggered on any error that occurs while the method is executing.

##### Examples

```javascript
// Reply to incoming traffic on all channels with 'thanks!'
const onMessage = message => {
  const channel = message.channel
  bot.chat.send({
    channel: channel,
    message: {
      body: 'thanks!!!',
    },
  })
}
bot.chat.watchAllChannelsForNewMessages(onMessage)
```

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>**

### Chat Types

A collection of types used by the Chat module.

#### ChatChannel

[lib/chat-client/types.js:23-29](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L20-L22 'Source code on GitHub')

A Keybase chat channel. This can be a channel in a team, or just an informal channel between two users.

Type: {name: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), public: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), membersType: MembersType, topicType: TopicType?, topicName: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?}

##### Properties

- `name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
- `public` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)**
- `membersType` **MembersType**
- `topicType` **TopicType?**
- `topicName` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**

#### ChatMessage

[lib/chat-client/types.js:34-36](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L31-L33 'Source code on GitHub')

A chat message. The content goes in the `body` property!

Type: {body: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}

##### Properties

- `body` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**

#### ChatConversation

[lib/chat-client/types.js:41-48](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L38-L40 'Source code on GitHub')

A chat conversation. This is essentially a chat channel plus some additional metadata.

Type: {id: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), channel: [ChatChannel](#chatchannel), unread: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), activeAt: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), activeAtMs: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), memberStatus: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}

##### Properties

- `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**
- `channel` **[ChatChannel](#chatchannel)**
- `unread` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)**
- `activeAt` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**
- `activeAtMs` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**
- `memberStatus` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**

#### ChatListOptions

[lib/chat-client/types.js:174-179](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L171-L173 'Source code on GitHub')

Options for the `list` method of the chat module.

Type: {unreadOnly: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, topicType: TopicType?, showErrors: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, failOffline: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?}

##### Properties

- `unreadOnly` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**
- `topicType` **TopicType?**
- `showErrors` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**
- `failOffline` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**

#### ChatReadOptions

[lib/chat-client/types.js:184-190](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L181-L183 'Source code on GitHub')

Options for the `read` method of the chat module.

Type: {conversationId: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?, peek: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, pagination: Pagination?, unreadOnly: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, failOffline: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?}

##### Properties

- `conversationId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**
- `peek` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**
- `pagination` **Pagination?**
- `unreadOnly` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**
- `failOffline` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**

#### ChatSendOptions

[lib/chat-client/types.js:195-199](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L192-L194 'Source code on GitHub')

Options for the `send` method of the chat module.

Type: {conversationId: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?, nonblock: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?, membersType: MembersType}

##### Properties

- `conversationId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**
- `nonblock` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?**
- `membersType` **MembersType**

#### ChatDeleteOptions

[lib/chat-client/types.js:204-206](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/types.js#L201-L203 'Source code on GitHub')

Options for the `delete` method of the chat module.

Type: {conversationId: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?}

##### Properties

- `conversationId` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**

#### OnMessage

[lib/chat-client/index.js:20-20](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L19-L19 'Source code on GitHub')

A function to call when a message is received.

Type: function (message: MessageSummary): void

#### OnError

[lib/chat-client/index.js:22-22](https://github.com/keybase/keybase-chat-bot/blob/58363d6d8d68c14f2a4e2f2cea05b2d53cb564d6/lib/chat-client/index.js#L21-L21 'Source code on GitHub')

A function to call when an error occurs.

Type: function (error: [Error](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error)): void
