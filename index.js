!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(global,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e){t.exports=require("child_process")},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),u=function(){function t(t,e,n,r){this.name=t,this.is=e,this.validate=n,this.encode=r}return t.prototype.pipe=function(n,r){var i=this;return new t(r||"pipe("+this.name+", "+n.name+")",n.is,function(t,e){var r=i.validate(t,e);return r.isLeft()?r:n.validate(r.value,e)},this.encode===e.identity&&n.encode===e.identity?e.identity:function(t){return i.encode(n.encode(t))})},t.prototype.asDecoder=function(){return this},t.prototype.asEncoder=function(){return this},t.prototype.decode=function(t){return this.validate(t,e.getDefaultContext(this))},t}();e.Type=u,e.identity=function(t){return t},e.getFunctionName=function(t){return t.displayName||t.name||"<function"+t.length+">"},e.getContextEntry=function(t,e){return{key:t,type:e}},e.getValidationError=function(t,e){return{value:t,context:e}},e.getDefaultContext=function(t){return[{key:"",type:t}]},e.appendContext=function(t,e,n){for(var r=t.length,i=Array(r+1),o=0;o<r;o++)i[o]=t[o];return i[r]={key:e,type:n},i},e.failures=function(t){return new o.Left(t)},e.failure=function(t,n){return e.failures([e.getValidationError(t,n)])},e.success=function(t){return new o.Right(t)};var a=function(t,e){for(var n=e.length,r=0;r<n;r++)t.push(e[r])},s=function(t){function n(){var n=t.call(this,"null",function(t){return null===t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="NullType",n}return r(n,t),n}(u);e.NullType=s,e.nullType=new s,e.null=e.nullType;var c=function(t){function n(){var n=t.call(this,"undefined",function(t){return void 0===t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="UndefinedType",n}return r(n,t),n}(u);e.UndefinedType=c;var f=new c;e.undefined=f;var l=function(t){function n(){var n=t.call(this,"void",f.is,f.validate,e.identity)||this;return n._tag="VoidType",n}return r(n,t),n}(u);e.VoidType=l,e.voidType=new l,e.void=e.voidType;var p=function(t){function n(){var n=t.call(this,"any",function(t){return!0},e.success,e.identity)||this;return n._tag="AnyType",n}return r(n,t),n}(u);e.AnyType=p,e.any=new p;var h=function(t){function n(){var n=t.call(this,"never",function(t){return!1},function(t,n){return e.failure(t,n)},function(){throw new Error("cannot encode never")})||this;return n._tag="NeverType",n}return r(n,t),n}(u);e.NeverType=h,e.never=new h;var v=function(t){function n(){var n=t.call(this,"string",function(t){return"string"==typeof t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="StringType",n}return r(n,t),n}(u);e.StringType=v,e.string=new v;var y=function(t){function n(){var n=t.call(this,"number",function(t){return"number"==typeof t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="NumberType",n}return r(n,t),n}(u);e.NumberType=y,e.number=new y;var d=function(t){function n(){var n=t.call(this,"boolean",function(t){return"boolean"==typeof t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="BooleanType",n}return r(n,t),n}(u);e.BooleanType=d,e.boolean=new d;var g=function(t){function n(){var n=t.call(this,"Array",Array.isArray,function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="AnyArrayType",n}return r(n,t),n}(u);e.AnyArrayType=g;var _=new g;e.Array=_;var m=function(t){function n(){var n=t.call(this,"Dictionary",function(t){return null!==t&&"object"==typeof t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="AnyDictionaryType",n}return r(n,t),n}(u);e.AnyDictionaryType=m,e.Dictionary=new m;var w=function(t){function n(){var n=t.call(this,"object",e.Dictionary.is,e.Dictionary.validate,e.identity)||this;return n._tag="ObjectType",n}return r(n,t),n}(u);e.ObjectType=w,e.object=new w;var T=function(t){function n(){var n=t.call(this,"Function",function(t){return"function"==typeof t},function(t,r){return n.is(t)?e.success(t):e.failure(t,r)},e.identity)||this;return n._tag="FunctionType",n}return r(n,t),n}(u);e.FunctionType=T,e.Function=new T;var b=function(t){function e(e,n,r,i,o,u){var a=t.call(this,e,n,r,i)||this;return a.type=o,a.predicate=u,a._tag="RefinementType",a}return r(e,t),e}(u);e.RefinementType=b,e.refinement=function(t,n,r){return void 0===r&&(r="("+t.name+" | "+e.getFunctionName(n)+")"),new b(r,function(e){return t.is(e)&&n(e)},function(r,i){var o=t.validate(r,i);if(o.isLeft())return o;var u=o.value;return n(u)?e.success(u):e.failure(u,i)},t.encode,t,n)},e.Integer=e.refinement(e.number,function(t){return t%1==0},"Integer");var O=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.value=o,u._tag="LiteralType",u}return r(e,t),e}(u);e.LiteralType=O,e.literal=function(t,n){void 0===n&&(n=JSON.stringify(t));var r=function(e){return e===t};return new O(n,r,function(n,i){return r(n)?e.success(t):e.failure(n,i)},e.identity,t)};var L=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.keys=o,u._tag="KeyofType",u}return r(e,t),e}(u);e.KeyofType=L,e.keyof=function(t,n){void 0===n&&(n="(keyof "+JSON.stringify(Object.keys(t))+")");var r=function(n){return e.string.is(n)&&t.hasOwnProperty(n)};return new L(n,r,function(t,n){return r(t)?e.success(t):e.failure(t,n)},e.identity,t)};var A=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.runDefinition=o,u._tag="RecursiveType",u}return r(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this.runDefinition()},enumerable:!0,configurable:!0}),e}(u);e.RecursiveType=A,e.recursion=function(t,e){var n,r=function(){return n||(n=e(i)),n},i=new A(t,function(t){return r().is(t)},function(t,e){return r().validate(t,e)},function(t){return r().encode(t)},r);return i};var P=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.type=o,u._tag="ArrayType",u}return r(e,t),e}(u);e.ArrayType=P,e.array=function(t,n){return void 0===n&&(n="Array<"+t.name+">"),new P(n,function(e){return _.is(e)&&e.every(t.is)},function(n,r){var i=_.validate(n,r);if(i.isLeft())return i;for(var o=i.value,u=o.length,s=o,c=[],f=0;f<u;f++){var l=o[f],p=t.validate(l,e.appendContext(r,String(f),t));if(p.isLeft())a(c,p.value);else{var h=p.value;h!==l&&(s===o&&(s=o.slice()),s[f]=h)}}return c.length?e.failures(c):e.success(s)},t.encode===e.identity?e.identity:function(e){return e.map(t.encode)},t)};var E=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.props=o,u._tag="InterfaceType",u}return r(e,t),e}(u);e.InterfaceType=E;var S=function(t){return"{ "+Object.keys(t).map(function(e){return e+": "+t[e].name}).join(", ")+" }"},N=function(t,n){for(var r=0;r<n;r++)if(t[r].encode!==e.identity)return!1;return!0};e.type=function(t,n){void 0===n&&(n=S(t));var r=Object.keys(t),o=r.map(function(e){return t[e]}),u=r.length;return new E(n,function(t){if(!e.Dictionary.is(t))return!1;for(var n=0;n<u;n++)if(!o[n].is(t[r[n]]))return!1;return!0},function(t,n){var s=e.Dictionary.validate(t,n);if(s.isLeft())return s;for(var c=s.value,f=c,l=[],p=0;p<u;p++){var h=r[p],v=c[h],y=o[p],d=y.validate(v,e.appendContext(n,h,y));if(d.isLeft())a(l,d.value);else{var g=d.value;g!==v&&(f===c&&(f=i({},c)),f[h]=g)}}return l.length?e.failures(l):e.success(f)},N(o,u)?e.identity:function(t){for(var n=i({},t),a=0;a<u;a++){var s=r[a],c=o[a].encode;c!==e.identity&&(n[s]=c(t[s]))}return n},t)},e.interface=e.type;var k=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.props=o,u._tag="PartialType",u}return r(e,t),e}(u);e.PartialType=k,e.partial=function(t,n){void 0===n&&(n="PartialType<"+S(t)+">");for(var r=Object.keys(t),o=r.map(function(e){return t[e]}),u=r.length,a={},s=0;s<u;s++)a[r[s]]=e.union([o[s],f]);var c=e.type(a);return new k(n,c.is,c.validate,N(o,u)?e.identity:function(t){for(var e=i({},t),n=0;n<u;n++){var a=r[n],s=t[a];void 0!==s&&(e[a]=o[n].encode(s))}return e},t)};var C=function(t){function e(e,n,r,i,o,u){var a=t.call(this,e,n,r,i)||this;return a.domain=o,a.codomain=u,a._tag="DictionaryType",a}return r(e,t),e}(u);e.DictionaryType=C,e.dictionary=function(t,n,r){return void 0===r&&(r="{ [K in "+t.name+"]: "+n.name+" }"),new C(r,function(r){return e.Dictionary.is(r)&&Object.keys(r).every(function(e){return t.is(e)&&n.is(r[e])})},function(r,i){var o=e.Dictionary.validate(r,i);if(o.isLeft())return o;for(var u=o.value,s={},c=[],f=Object.keys(u),l=f.length,p=!1,h=0;h<l;h++){var v=f[h],y=u[v],d=t.validate(v,e.appendContext(i,v,t)),g=n.validate(y,e.appendContext(i,v,n));if(d.isLeft())a(c,d.value);else{var _=d.value;p=p||_!==v,v=_}if(g.isLeft())a(c,g.value);else{var m=g.value;p=p||m!==y,s[v]=m}}return c.length?e.failures(c):e.success(p?s:u)},t.encode===e.identity&&n.encode===e.identity?e.identity:function(e){for(var r={},i=Object.keys(e),o=i.length,u=0;u<o;u++){var a=i[u];r[String(t.encode(a))]=n.encode(e[a])}return r},t,n)};var M=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.types=o,u._tag="UnionType",u}return r(e,t),e}(u);e.UnionType=M,e.union=function(t,n){void 0===n&&(n="("+t.map(function(t){return t.name}).join(" | ")+")");var r=t.length;return new M(n,function(e){return t.some(function(t){return t.is(e)})},function(n,i){for(var o=[],u=0;u<r;u++){var s=t[u],c=s.validate(n,e.appendContext(i,String(u),s));if(c.isRight())return c;a(o,c.value)}return e.failures(o)},N(t,r)?e.identity:function(e){for(var n=0;n<r-1;n++){var i=t[n];if(i.is(e))return i.encode(e)}return t[n].encode(e)},t)};var R=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.types=o,u._tag="IntersectionType",u}return r(e,t),e}(u);e.IntersectionType=R,e.intersection=function(t,n){void 0===n&&(n="("+t.map(function(t){return t.name}).join(" & ")+")");var r=t.length;return new R(n,function(e){return t.every(function(t){return t.is(e)})},function(n,i){for(var o=n,u=[],s=0;s<r;s++){var c=t[s].validate(o,i);c.isLeft()?a(u,c.value):o=c.value}return u.length?e.failures(u):e.success(o)},N(t,r)?e.identity:function(e){for(var n=e,i=0;i<r;i++)n=t[i].encode(n);return n},t)};var j=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.types=o,u._tag="TupleType",u}return r(e,t),e}(u);e.TupleType=j,e.tuple=function(t,n){void 0===n&&(n="["+t.map(function(t){return t.name}).join(", ")+"]");var r=t.length;return new j(n,function(e){return _.is(e)&&e.length===r&&t.every(function(t,n){return t.is(e[n])})},function(n,i){var o=_.validate(n,i);if(o.isLeft())return o;for(var u=o.value,s=u,c=[],f=0;f<r;f++){var l=u[f],p=t[f],h=p.validate(l,e.appendContext(i,String(f),p));if(h.isLeft())a(c,h.value);else{var v=h.value;v!==l&&(s===u&&(s=u.slice()),s[f]=v)}}return u.length>r&&c.push(e.getValidationError(u[r],e.appendContext(i,String(r),e.never))),c.length?e.failures(c):e.success(s)},N(t,r)?e.identity:function(e){return t.map(function(t,n){return t.encode(e[n])})},t)};var G=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.type=o,u._tag="ReadonlyType",u}return r(e,t),e}(u);e.ReadonlyType=G,e.readonly=function(t,n){return void 0===n&&(n="Readonly<"+t.name+">"),new G(n,t.is,function(e,n){return t.validate(e,n).map(function(t){return t})},t.encode===e.identity?e.identity:t.encode,t)};var I=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.type=o,u._tag="ReadonlyArrayType",u}return r(e,t),e}(u);e.ReadonlyArrayType=I,e.readonlyArray=function(t,n){void 0===n&&(n="ReadonlyArray<"+t.name+">");var r=e.array(t);return new I(n,r.is,function(t,e){return r.validate(t,e).map(function(t){return t})},r.encode,t)};var x=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.props=o,u._tag="StrictType",u}return r(e,t),e}(u);e.StrictType=x,e.strict=function(t,n){void 0===n&&(n="StrictType<"+S(t)+">");var r=W(e.type(t));return new x(n,r.is,r.validate,r.encode,t)},e.isTagged=function(t){var e=function(n){return n instanceof E||n instanceof x?n.props.hasOwnProperty(t):n instanceof R?n.types.some(e):n instanceof M?n.types.every(e):(n instanceof b||n instanceof F)&&e(n.type)};return e};e.getTagValue=function(t){var n=function(r){switch(r._tag){case"InterfaceType":case"StrictType":return r.props[t].value;case"IntersectionType":return n(function(t,n){for(var r=n.length,i=e.isTagged(t),o=0;o<r-1;o++){var u=n[o];if(i(u))return u}return n[o]}(t,r.types));case"UnionType":return n(r.types[0]);case"RefinementType":case"ExactType":case"RecursiveType":return n(r.type)}};return n};var D=function(t){function e(e,n,r,i,o,u){var a=t.call(this,e,n,r,i,o)||this;return a.tag=u,a}return r(e,t),e}(M);e.TaggedUnionType=D,e.taggedUnion=function(t,n,r){void 0===r&&(r="("+n.map(function(t){return t.name}).join(" | ")+")");for(var i=n.length,o=new Array(i),a={},s=!0,c=e.getTagValue(t),f=0;f<i;f++){var l=c(n[f]);s=s&&e.string.is(l),o[f]=l,a[String(l)]=f}var p=s?function(t){return e.string.is(t)&&a.hasOwnProperty(t)}:function(t){return-1!==o.indexOf(t)},h=s?function(t){return a[t]}:function(t){for(var e=0;e<i-1&&o[e]!==t;e++);return e},v=new u(o.map(function(t){return JSON.stringify(t)}).join(" | "),p,function(t,n){return p(t)?e.success(t):e.failure(t,n)},e.identity);return new D(r,function(r){if(!e.Dictionary.is(r))return!1;var i=r[t];return v.is(i)&&n[h(i)].is(r)},function(r,i){var o=e.Dictionary.validate(r,i);if(o.isLeft())return o;var u=o.value,a=v.validate(u[t],e.appendContext(i,t,v));if(a.isLeft())return a;var s=h(a.value),c=n[s];return c.validate(u,e.appendContext(i,String(s),c))},N(n,i)?e.identity:function(e){return n[h(e[t])].encode(e)},n,t)};var F=function(t){function e(e,n,r,i,o){var u=t.call(this,e,n,r,i)||this;return u.type=o,u._tag="ExactType",u}return r(e,t),e}(u);e.ExactType=F;var U=function(t){switch(t._tag){case"RefinementType":case"ReadonlyType":return U(t.type);case"InterfaceType":case"StrictType":case"PartialType":return t.props;case"IntersectionType":return t.types.reduce(function(t,e){return Object.assign(t,U(e))},{})}};function W(t,n){void 0===n&&(n="ExactType<"+t.name+">");var r=U(t);return new F(n,function(e){return t.is(e)&&Object.getOwnPropertyNames(e).every(function(t){return r.hasOwnProperty(t)})},function(n,i){var o=t.validate(n,i);if(o.isLeft())return o;for(var u=o.value,a=Object.getOwnPropertyNames(u),s=a.length,c=[],f=0;f<s;f++){var l=a[f];r.hasOwnProperty(l)||c.push(e.getValidationError(u[l],e.appendContext(i,l,e.never)))}return c.length?e.failures(c):e.success(u)},t.encode,t)}e.exact=W,e.clean=function(t){return t},e.alias=function(t){return function(){return t}}},function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(4);e.URI="Either";var u=function(){function t(t){this.value=t,this._tag="Left"}return t.prototype.map=function(t){return this},t.prototype.ap=function(t){return t.isLeft()?t:this},t.prototype.ap_=function(t){return t.ap(this)},t.prototype.chain=function(t){return this},t.prototype.bimap=function(e,n){return new t(e(this.value))},t.prototype.alt=function(t){return t},t.prototype.orElse=function(t){return t(this.value)},t.prototype.extend=function(t){return this},t.prototype.reduce=function(t,e){return t},t.prototype.fold=function(t,e){return t(this.value)},t.prototype.getOrElse=function(t){return t},t.prototype.getOrElseL=function(t){return t(this.value)},t.prototype.mapLeft=function(e){return new t(e(this.value))},t.prototype.inspect=function(){return this.toString()},t.prototype.toString=function(){return"left("+o.toString(this.value)+")"},t.prototype.isLeft=function(){return!0},t.prototype.isRight=function(){return!1},t.prototype.swap=function(){return new a(this.value)},t.prototype.filterOrElse=function(t,e){return this},t.prototype.filterOrElseL=function(t,e){return this},t.prototype.refineOrElse=function(t,e){return this},t.prototype.refineOrElseL=function(t,e){return this},t}();e.Left=u;var a=function(){function t(t){this.value=t,this._tag="Right"}return t.prototype.map=function(e){return new t(e(this.value))},t.prototype.ap=function(t){return t.isRight()?this.map(t.value):e.left(t.value)},t.prototype.ap_=function(t){return t.ap(this)},t.prototype.chain=function(t){return t(this.value)},t.prototype.bimap=function(e,n){return new t(n(this.value))},t.prototype.alt=function(t){return this},t.prototype.orElse=function(t){return this},t.prototype.extend=function(e){return new t(e(this))},t.prototype.reduce=function(t,e){return e(t,this.value)},t.prototype.fold=function(t,e){return e(this.value)},t.prototype.getOrElse=function(t){return this.value},t.prototype.getOrElseL=function(t){return this.value},t.prototype.mapLeft=function(e){return new t(this.value)},t.prototype.inspect=function(){return this.toString()},t.prototype.toString=function(){return"right("+o.toString(this.value)+")"},t.prototype.isLeft=function(){return!1},t.prototype.isRight=function(){return!0},t.prototype.swap=function(){return new u(this.value)},t.prototype.filterOrElse=function(t,n){return t(this.value)?this:e.left(n)},t.prototype.filterOrElseL=function(t,n){return t(this.value)?this:e.left(n(this.value))},t.prototype.refineOrElse=function(t,n){return t(this.value)?this:e.left(n)},t.prototype.refineOrElseL=function(t,n){return t(this.value)?this:e.left(n(this.value))},t}();e.Right=a,e.getSetoid=function(t,e){return{equals:function(n,r){return n.isLeft()?r.isLeft()&&t.equals(n.value,r.value):r.isRight()&&e.equals(n.value,r.value)}}},e.getSemigroup=function(t){return{concat:function(n,r){return r.isLeft()?n:n.isLeft()?r:e.right(t.concat(n.value,r.value))}}},e.getApplySemigroup=function(t){return{concat:function(n,r){return n.isLeft()?n:r.isLeft()?r:e.right(t.concat(n.value,r.value))}}},e.getApplyMonoid=function(t){return r({},e.getApplySemigroup(t),{empty:e.right(t.empty)})};var s=function(t,e){return t.map(e)},c=function(t){return new a(t)},f=function(t,e,n){return t.reduce(e,n)},l=function(t){return function(n,r){return n.isLeft()?t.of(e.left(n.value)):t.map(r(n.value),c)}};function p(t){return{URI:e.URI,_L:o.phantom,compact:function(n){return n.isLeft()?n:n.value.isNone()?e.left(t.empty):e.right(n.value.value)},separate:function(n){return n.isLeft()?{left:n,right:n}:n.value.isLeft()?{left:e.right(n.value.value),right:e.left(t.empty)}:{left:e.left(t.empty),right:e.right(n.value.value)}}}}function h(t){var n=p(t);return r({},n,{map:s,partitionMap:function(n,r){if(n.isLeft())return{left:n,right:n};var i=r(n.value);return i.isLeft()?{left:e.right(i.value),right:e.left(t.empty)}:{left:e.left(t.empty),right:e.right(i.value)}},filterMap:function(n,r){if(n.isLeft())return n;var i=r(n.value);return i.isSome()?e.right(i.value):e.left(t.empty)},partition:function(n,r){return n.isLeft()?{left:n,right:n}:r(n.value)?{left:e.left(t.empty),right:e.right(n.value)}:{left:e.right(n.value),right:e.left(t.empty)}},filter:function(e,n){return e.filterOrElse(n,t.empty)}})}e.left=function(t){return new u(t)},e.right=c,e.fromPredicate=function(t,n){return function(r){return t(r)?e.right(r):e.left(n(r))}},e.fromRefinement=function(t,n){return function(r){return t(r)?e.right(r):e.left(n(r))}},e.fromOption=function(t){return function(n){return n.isNone()?e.left(t):e.right(n.value)}},e.fromOptionL=function(t){return function(n){return n.isNone()?e.left(t()):e.right(n.value)}},e.fromNullable=function(t){return function(n){return null==n?e.left(t):e.right(n)}},e.toError=function(t){return t instanceof Error?t:new Error(String(t))},e.tryCatch=function(t,n){void 0===n&&(n=e.toError);try{return e.right(t())}catch(t){return e.left(n(t))}},e.fromValidation=function(t){return t.isFailure()?e.left(t.value):e.right(t.value)},e.isLeft=function(t){return t.isLeft()},e.isRight=function(t){return t.isRight()},e.getCompactable=p,e.getFilterable=h,e.getWitherable=function(t){var e=h(t);return r({},e,{traverse:l,reduce:f,wither:function(t){var n=l(t);return function(r,i){return t.map(n(r,i),e.compact)}},wilt:function(t){var n=l(t);return function(r,i){return t.map(n(r,i),e.separate)}}})},e.either={URI:e.URI,map:s,of:c,ap:function(t,e){return e.ap(t)},chain:function(t,e){return t.chain(e)},reduce:f,traverse:l,bimap:function(t,e,n){return t.bimap(e,n)},alt:function(t,e){return t.alt(e)},extend:function(t,e){return t.extend(e)},chainRec:function(t,n){return i.tailRec(function(t){if(t.isLeft())return e.right(e.left(t.value));var r=t.value;return r.isLeft()?e.left(n(r.value)):e.right(e.right(r.value))},n(t))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tailRec=function(t,e){for(var n=t(e);n.isLeft();)n=t(n.value);return n.value}},function(t,e,n){"use strict";function r(t,n,i){return function(o){var u=e.concat(i,[o]);return 0===n?t.apply(this,u):r(t,n-1,u)}}Object.defineProperty(e,"__esModule",{value:!0}),e.identity=function(t){return t},e.unsafeCoerce=e.identity,e.not=function(t){return function(e){return!t(e)}},e.or=function(t,e){return function(n){return t(n)||e(n)}},e.and=function(t,e){return function(n){return t(n)&&e(n)}},e.constant=function(t){return function(){return t}},e.constTrue=function(){return!0},e.constFalse=function(){return!1},e.constNull=function(){return null},e.constUndefined=function(){},e.flip=function(t){return function(e){return function(n){return t(n)(e)}}},e.on=function(t){return function(e){return function(n,r){return t(e(n),e(r))}}},e.compose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length-1;return function(e){for(var r=e,i=n;i>-1;i--)r=t[i].call(this,r);return r}},e.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length-1;return function(e){for(var r=e,i=0;i<=n;i++)r=t[i].call(this,r);return r}},e.concat=function(t,e){for(var n=t.length,r=e.length,i=Array(n+r),o=0;o<n;o++)i[o]=t[o];for(o=0;o<r;o++)i[o+n]=e[o];return i},e.curried=r,e.curry=function(t){return r(t,t.length-1,[])};e.toString=function(t){if("string"==typeof t)return JSON.stringify(t);if(t instanceof Date)return"new Date('"+t.toISOString()+"')";if(Array.isArray(t))return"["+t.map(e.toString).join(", ")+"]";if("function"==typeof t)return function(t){return t.displayName||t.name||"<function"+t.length+">"}(t);if(null==t)return String(t);if(t.toString!==Object.prototype.toString)return t.toString();try{return JSON.stringify(t,null,2)}catch(e){return String(t)}},e.tuple=function(t,e){return[t,e]},e.tupleCurried=function(t){return function(e){return[t,e]}},e.apply=function(t){return function(e){return t(e)}},e.applyFlipped=function(t){return function(e){return e(t)}},e.phantom=void 0,e.constIdentity=function(){return e.identity},e.increment=function(t){return t+1},e.decrement=function(t){return t-1}},function(t,e,n){"use strict";n.r(e);var r=n(0);function i(t,e){t.stdinBuffer;var n=null,i=(Date.now(),null),o=[],u=Object(r.spawn)(t.command,t.args||[]);u.stdout.on("data",function(t){o.push(t)}),u.on("close",function(t){if(t)i=new Error("exited with code ".concat(t));else{var r=Buffer.concat(o).toString("utf8");try{n=JSON.parse(r)}catch(t){n="No JSON"}}e(i,n)})}function o(t){!function(t){i({command:"keybase",args:["status","-j"]},function(e,n){t(e,n)})}(function(e,n){return n&&n.Username&&n.Device&&n.Device.name?t(null,{username:n.Username,devicename:n.Device.name}):(e||(e=new Error("failed to get username + device name")),t(e,null))})}var u=1;function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._bot=e.bot,this._onMessages=e.onMessages,this._channel=e.channel,this._highestId=-1,this._loopCount=0,this._watchLoop()}return function(t,e,n){e&&a(t.prototype,e),n&&a(t,n)}(t,[{key:"_didISendMessage",value:function(t){var e=this._bot.myInfo();return!!e&&e.username===t.msg.sender.username}},{key:"_checkForNewMessages",value:function(t){var e=this,n=[];this._bot.chatRead({channel:this._channel,unreadOnly:!0},function(r,i){return r&&console.log(r),i&&i.ratelimits&&e._bot._gasPreserver.passGas(i.ratelimits),i&&i.messages&&(n=i.messages,e._highestId=i.messages.reduce(function(t,e){return Math.max(t,e.msg.id)},e._highestId)),console.log("loopCount: ".concat(e._loopCount," newMessages: ").concat(n.length)),n.length&&e._onMessages({messages:n,channel:e._channel}),t(r)})}},{key:"_watchLoop",value:function(){var t=this;console.log("".concat(this._loopCount," '").concat(this._channel.name," entering watchLoop")),this._checkForNewMessages(function(){var e=t._bot._gasPreserver.recommendedWait();console.log("".concat(t._loopCount," '").concat(t._channel.name," finishing watchLoop ").concat(e)),setTimeout(function(){t._loopCount++,t._watchLoop()},e)})}}]),t}();function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._bot=e.bot,this._onMessages=e.onMessages,this._loopCount=0,this._watchLoop()}return function(t,e,n){e&&c(t.prototype,e),n&&c(t,n)}(t,[{key:"_checkForNewMessagesInOneConversation",value:function(t,e){var n=this;this._bot.chatRead({channel:t.channel,unreadOnly:!0},function(r,i){if(i&&i.ratelimits&&n._bot._gasPreserver.passGas(i.ratelimits),i&&i.messages){var o=i.messages;console.log("found: ".concat(o.length," newMessages: ").concat(t.channel)),i.messages.length&&n._onMessages({messages:o,channel:t.channel})}e(r)})}},{key:"_checkForNewMessagesInConversations",value:function(t,e){var n=this,r=t.conversations,i=t.index;if(i||(i=0),i===r.length)return e(null);console.log("CHECKING ".concat(i,", ").concat(r[i].channel," for new messages")),this._checkForNewMessagesInOneConversation(r[i],function(t,o){if(i+1===r.length)return e(t);n._checkForNewMessagesInConversations({conversations:r,index:i+1},e)})}},{key:"_checkForNewMessagesInAllConversations",value:function(t){var e=this;this._bot.chatList(null,function(n,r){if(n)return console.log("Got error getting chat list:",n),t(n);if(r&&r.ratelimits&&e._bot._gasPreserver.passGas(r.ratelimits),r&&r.conversations){var i=r.conversations.filter(function(t){return t.unread});console.log("Of ".concat(r.conversations.length," there are ").concat(i.length," that are unread.")),e._checkForNewMessagesInConversations({conversations:i},function(e){t(e)})}})}},{key:"_watchLoop",value:function(){var t=this;this._checkForNewMessagesInAllConversations(function(){var e=t._bot._gasPreserver.recommendedWait();setTimeout(function(){t._loopCount++,t._watchLoop()},e)})}}]),t}(),l={MIN_CHANNEL_WATCH_LOOP:1e3,MAX_CHANNEL_WATCH_LOOP:6e4,DEFAULT_GAS:500,DEFAULT_TIME_LEFT:1500,TARGET_GAS_REMAINING:100,SAFETY_BUFFER:1.5,GAS_MONITOR_WINDOW:1e4,GAS_ADJ_MULT:1.1};function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var h=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._lastPassedGas=[],this._currentWait=l.MIN_CHANNEL_WATCH_LOOP}return function(t,e,n){e&&p(t.prototype,e),n&&p(t,n)}(t,[{key:"passGas",value:function(t){this._lastPassedGas.push(t[0]),this._filterOldGas()}},{key:"recommendedWait",value:function(){var t=this._getCurrentSpeed(),e=this._getRemainingGas(),n=Math.max(0,e-l.TARGET_GAS_REMAINING),r=this._getTimeTillReset();return t*r>n?this._currentWait*=l.GAS_ADJ_MULT:this._currentWait/=l.GAS_ADJ_MULT,this._currentWait=Math.max(l.MIN_CHANNEL_WATCH_LOOP,this._currentWait),this._currentWait=Math.min(l.MAX_CHANNEL_WATCH_LOOP,this._currentWait),console.log("...speed=".concat(t.toFixed(2),", gas=").concat(e,", timeLeft=").concat(r,", currentWait=").concat(this._currentWait,", history=").concat(this._lastPassedGas.length)),this._currentWait}},{key:"_filterOldGas",value:function(){var t=0;for(t=this._lastPassedGas.length-2;t>=0;t--){var e=this._lastPassedGas[this._lastPassedGas.length-1],n=this._lastPassedGas[t];if(n.gas<e.gas||n.reset<e.reset)break}if(t>=0&&(console.log("BEFORE GAS CLEANUP",this._lastPassedGas),this._lastPassedGas.splice(0,t+1),console.log("AFTER GAS CLEANUP",this._lastPassedGas)),this._lastPassedGas.length>2){var r=this._lastPassedGas.slice(-2),i=this._lastPassedGas.slice(0,-2);i=i.filter(function(t){return t.reset<r[1].reset+l.GAS_MONITOR_WINDOW/1e3}),this._lastPassedGas=i.concat(r)}}},{key:"_getCurrentSpeed",value:function(){if(this._lastPassedGas.length<2)return 1;var t=this._lastPassedGas,e=t[t.length-1];return(t[0].gas-e.gas)/(1+t[0].reset-e.reset)}},{key:"_getRemainingGas",value:function(){return this._lastPassedGas.length<1?l.DEFAULT_GAS:this._lastPassedGas[this._lastPassedGas.length-1].gas}},{key:"_getTimeTillReset",value:function(){return this._lastPassedGas.length<1?l.DEFAULT_TIME_LEFT:this._lastPassedGas[this._lastPassedGas.length-1].reset}}]),t}();n(1);function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._verbose=!1,this._dPair=null,this._initialized=!1,this._channelWatchers=new Map,this._fullWatcher=null,this._gasPreserver=new h}return function(t,e,n){e&&v(t.prototype,e),n&&v(t,n)}(t,[{key:"init",value:function(t,e){this._verbose=t.verbose,i({command:"keybase",args:["oneshot","--username",t.username,"--paperkey",t.paperkey]},function(t,e){console.log(t,e)})}},{key:"chatList",value:function(t,e){if(t)throw new Error("options (arg1) for chatList not yet supported. Please pass null.");this._safelyRunApiCommand({method:"list",options:{}},function(t,n){return e(t,n)})}},{key:"chatSend",value:function(t,e){var n=t.channel,r=t.message;this._safelyRunApiCommand({method:"send",options:{channel:n,message:r}},function(t,n){return e(t,n)})}},{key:"chatRead",value:function(t,e){var n=t.channel,r=!1,i=!1;void 0!==t.peek&&(r=t.peek),void 0!==t.unreadOnly&&(i=t.unreadOnly),this._safelyRunApiCommand({method:"read",options:{channel:n,peek:r,unread_only:i}},function(t,n){return e(t,n)})}},{key:"chatDelete",value:function(t,e){var n=t.channel,r=t.messageId;this._safelyRunApiCommand({method:"delete",options:{channel:n,message_id:r}},function(t,n){return e(t,n)})}},{key:"myInfo",value:function(){return this._dPair}},{key:"watchChannelForNewMessages",value:function(t){var e=t.channel,n=t.onMessages,r=function(t){return JSON.stringify([t.name,t.public,t.topic_type])}(e);if(this._channelWatchers.has(r))throw new Error("already watching the channel ".concat(JSON.stringify(e)));this._channelWatchers.set(r,new s({channel:e,onMessages:n,bot:this}))}},{key:"watchAllChannelsForNewMessages",value:function(t){var e=t.onMessages;if(this._fullWatcher)throw new Error("already watching watching; can't have 2 message watchers}");this._fullWatcher=new f({onMessages:e,bot:this})}},{key:"_log",value:function(t){this._verbose&&console.log(t)}},{key:"_checkUserAndInit",value:function(t){var e=this;o(function(n,r){return n||e._initialized&&r&&e._dPair&&r.username===e._dPair.username||(n=new Error("Uh-oh, username has changed or we never initialized correctly.")),t(n)})}},{key:"_safelyRunApiCommand",value:function(t,e){this._checkUserAndInit(function(n){if(n)return e(n,null);!function(t,e){var n={method:t.method,params:{version:u,options:t.options}};i({command:"keybase",args:["chat","api"],stdinBuffer:new Buffer(JSON.stringify(n),"utf8")},function(t,n){var r=null;if(!t)if(n&&n.result)r=n.result;else if(n&&n.error){var i=n.error;t=new Error(i.message||i.toString())}else t=new Error('Unknown error parsing result - no "result" field');e(t,r)})}(t,function(t,n){return e(t,n)})})}}]),t}();n.d(e,"Bot",function(){return y})}])});